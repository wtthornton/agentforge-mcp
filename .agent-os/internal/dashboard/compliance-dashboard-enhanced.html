<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Agent-OS Compliance Dashboard</title>
    
    <!-- CSS Variables for consistent theming -->
    <style>
        :root {
            --primary-color: #007bff;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --text-primary: #333333;
            --text-secondary: #6c757d;
            --border-radius: 8px;
            --card-shadow: 0 2px 8px rgba(0,0,0,0.1);
            --transition-speed: 0.2s ease;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --background-color: #1a1a1a;
                --card-background: #2d2d2d;
                --text-primary: #ffffff;
                --text-secondary: #b0b0b0;
            }
        }

        * { 
            box-sizing: border-box; 
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: var(--background-color); 
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error handling */
        .error-message {
            background: var(--danger-color);
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            display: none;
        }

        /* Notification system */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }

        .notification {
            background: var(--card-background);
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            animation: slideIn 0.3s ease;
        }

        .notification-success { border-left-color: var(--success-color); }
        .notification-warning { border-left-color: var(--warning-color); }
        .notification-error { border-left-color: var(--danger-color); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Header */
        .header { 
            background: var(--card-background); 
            padding: 20px; 
            border-radius: var(--border-radius); 
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }

        .header h1 {
            margin: 0 0 10px 0;
            color: var(--text-primary);
        }

        .header p {
            margin: 0;
            color: var(--text-secondary);
        }

        /* Score display */
        .score { 
            font-size: 3em; 
            font-weight: bold; 
            text-align: center;
            margin: 20px 0;
        }

        .critical { color: var(--danger-color); }
        .warning { color: var(--warning-color); }
        .success { color: var(--success-color); }
        .info { color: var(--info-color); }
        
        /* Metrics grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .metric-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        /* Filter section */
        .filter-section {
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            margin: 20px 0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-section input,
        .filter-section select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            min-height: 44px;
        }

        .filter-section input:focus,
        .filter-section select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        /* Export section */
        .export-section {
            background: var(--card-background);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 8px 16px;
            border: 1px solid var(--primary-color);
            background: var(--card-background);
            color: var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all var(--transition-speed);
            min-height: 44px;
            min-width: 44px;
        }

        .export-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Violations */
        .violation { 
            margin: 10px 0; 
            padding: 15px; 
            border-left: 4px solid; 
            background: var(--card-background);
            border-radius: 4px;
            box-shadow: var(--card-shadow);
        }

        .critical { border-color: var(--danger-color); background: #f8d7da; }
        .warning { border-color: var(--warning-color); background: #fff3cd; }
        
        /* Analytics sections */
        .analytics-section {
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            margin: 20px 0;
        }

        .analytics-section h2 {
            cursor: pointer;
            user-select: none;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analytics-section h2::before {
            content: 'â–¼';
            transition: transform var(--transition-speed);
        }

        .analytics-section.collapsed h2::before {
            transform: rotate(-90deg);
        }
        
        .chart-container {
            background: var(--card-background);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            margin: 20px 0;
        }

        .chart-container h3 {
            margin-top: 0;
            color: var(--text-primary);
        }
        
        .trend-chart {
            width: 100%;
            height: 300px;
            margin: 20px 0;
            position: relative;
        }

        /* Issue items */
        .issue-item {
            background: var(--background-color);
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid var(--primary-color);
        }
        
        .severity-critical { border-left-color: var(--danger-color); }
        .severity-high { border-left-color: #fd7e14; }
        .severity-medium { border-left-color: var(--warning-color); }
        .severity-low { border-left-color: var(--success-color); }

        /* File type stats */
        .file-type-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .file-type-card {
            background: var(--background-color);
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }
        
        /* Trend indicators */
        .trend-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .trend-improving { background: #d4edda; color: #155724; }
        .trend-declining { background: #f8d7da; color: #721c24; }
        .trend-stable { background: #d1ecf1; color: #0c5460; }

        /* Responsive design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 0;
            }

            .header {
                padding: 15px;
            }

            .metric-card {
                padding: 15px;
            }

            .chart-container {
                height: 250px;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }

            .export-section {
                justify-content: center;
            }

            .notification-container {
                left: 10px;
                right: 10px;
                max-width: none;
            }
        }

        /* Accessibility improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus indicators */
        button:focus,
        input:focus,
        select:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --primary-color: #000080;
                --success-color: #008000;
                --warning-color: #ff8c00;
                --danger-color: #ff0000;
            }
        }
    </style>
</head>
<body>
    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Loading compliance data...</p>
    </div>

    <!-- Error message -->
    <div class="error-message" id="errorMessage">
        <p>Failed to load data. Please refresh the page.</p>
    </div>

    <!-- Notification container -->
    <div class="notification-container" id="notificationContainer"></div>

    <div class="container">
        <div class="header">
            <h1>Enhanced Agent-OS Compliance Dashboard</h1>
            <p>Real-time analytics and trend analysis for Agent OS framework compliance</p>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <input type="text" id="searchViolations" placeholder="Search violations..." aria-label="Search violations">
            <select id="severityFilter" aria-label="Filter by severity">
                <option value="">All Severities</option>
                <option value="critical">Critical</option>
                <option value="warning">Warning</option>
                <option value="info">Info</option>
            </select>
            <select id="fileTypeFilter" aria-label="Filter by file type">
                <option value="">All File Types</option>
                <option value="js">JavaScript</option>
                <option value="ts">TypeScript</option>
                <option value="java">Java</option>
                <option value="md">Markdown</option>
            </select>
        </div>

        <!-- Export Section -->
        <div class="export-section">
            <button class="export-btn" id="exportPDF" aria-label="Export dashboard as PDF">
                ðŸ“„ Export PDF
            </button>
            <button class="export-btn" id="exportCSV" aria-label="Export data as CSV">
                ðŸ“Š Export CSV
            </button>
            <button class="export-btn" id="exportJSON" aria-label="Export data as JSON">
                ðŸ“‹ Export JSON
            </button>
        </div>

        <!-- Compliance Score -->
        <div id="complianceScore" class="score" role="status" aria-live="polite"></div>
        
        <!-- Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-title">Total Violations</div>
                <div class="metric-value" id="totalViolations" aria-label="Total violations count"></div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Critical Violations</div>
                <div class="metric-value" id="criticalViolations" aria-label="Critical violations count"></div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Execution Time</div>
                <div class="metric-value" id="executionTime" aria-label="Execution time in milliseconds"></div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Files Processed</div>
                <div class="metric-value" id="filesProcessed" aria-label="Number of files processed"></div>
            </div>
        </div>

        <!-- Enhanced Trend Analysis Section -->
        <div class="analytics-section" role="region" aria-label="Trend Analysis">
            <h2>ðŸ“ˆ Trend Analysis & Forecasting</h2>
            
            <!-- Trend Charts -->
            <div class="chart-container" role="region" aria-label="Compliance Score Trends">
                <h3 id="complianceChartTitle">Compliance Score Trends</h3>
                <div class="trend-chart">
                    <canvas id="complianceTrendChart" aria-labelledby="complianceChartTitle"></canvas>
                </div>
                <div class="trend-indicator" id="complianceTrendIndicator" aria-live="polite"></div>
            </div>
            
            <div class="chart-container" role="region" aria-label="Violation Count Trends">
                <h3 id="violationChartTitle">Violation Count Trends</h3>
                <div class="trend-chart">
                    <canvas id="violationTrendChart" aria-labelledby="violationChartTitle"></canvas>
                </div>
                <div class="trend-indicator" id="violationTrendIndicator" aria-live="polite"></div>
            </div>
            
            <div class="chart-container" role="region" aria-label="Performance Metrics Trends">
                <h3 id="performanceChartTitle">Performance Metrics Trends</h3>
                <div class="trend-chart">
                    <canvas id="performanceTrendChart" aria-labelledby="performanceChartTitle"></canvas>
                </div>
                <div class="trend-indicator" id="performanceTrendIndicator" aria-live="polite"></div>
            </div>

            <!-- New Chart Types -->
            <div class="chart-container" role="region" aria-label="Violation Distribution">
                <h3 id="distributionChartTitle">Violation Distribution</h3>
                <div class="trend-chart">
                    <canvas id="violationPieChart" aria-labelledby="distributionChartTitle"></canvas>
                </div>
            </div>

            <div class="chart-container" role="region" aria-label="File Type Analysis">
                <h3 id="fileTypeChartTitle">File Type Analysis</h3>
                <div class="trend-chart">
                    <canvas id="fileTypeChart" aria-labelledby="fileTypeChartTitle"></canvas>
                </div>
            </div>
        </div>

        <!-- Enhanced Forecast Section -->
        <div class="forecast-section" role="region" aria-label="Predictive Analytics">
            <h2>ðŸ”® Predictive Analytics & Forecasting</h2>
            <div id="forecastContainer"></div>
        </div>

        <!-- Enhanced Timeline Visualization -->
        <div class="timeline-container" role="region" aria-label="Violation Timeline">
            <h2>ðŸ“… Violation Timeline & Historical Analysis</h2>
            <div id="timelineContainer"></div>
        </div>

        <!-- Enhanced Progress Tracking -->
        <div class="progress-section" role="region" aria-label="Progress Tracking">
            <h2>ðŸ“Š Progress Tracking & Improvement Metrics</h2>
            <div id="progressContainer"></div>
        </div>

        <!-- Enhanced Trend Comparison -->
        <div class="comparison-grid" role="region" aria-label="Trend Comparison">
            <div class="comparison-card">
                <h3>Period-to-Period Comparison</h3>
                <div class="period-selector" role="tablist">
                    <button class="period-btn active" role="tab" aria-selected="true" data-period="7" tabindex="0">Last 7 Days</button>
                    <button class="period-btn" role="tab" aria-selected="false" data-period="14" tabindex="0">Last 14 Days</button>
                    <button class="period-btn" role="tab" aria-selected="false" data-period="30" tabindex="0">Last 30 Days</button>
                </div>
                <div class="comparison-chart">
                    <canvas id="comparisonChart" aria-label="Period comparison chart"></canvas>
                </div>
            </div>
            
            <div class="comparison-card">
                <h3>Trend Indicators & Analysis</h3>
                <div id="trendIndicators"></div>
            </div>
        </div>

        <!-- Enhanced Insights Panel -->
        <div class="insights-panel" role="region" aria-label="Smart Insights">
            <h2>ðŸ’¡ Smart Insights & Recommendations</h2>
            <div id="insightsContainer"></div>
        </div>

        <!-- Violations Container -->
        <div id="violations" role="region" aria-label="Compliance Violations"></div>
        
        <!-- Analytics Container -->
        <div id="analytics" role="region" aria-label="Analytics Data"></div>
        
        <!-- Issues Container -->
        <div id="issues" role="region" aria-label="Issues and Problems"></div>
    </div>

    <script>
        // Enhanced Compliance Dashboard with Agent-OS Standards
        // Following mobile-first design, accessibility, and performance best practices

        // Data Management with caching
        class ComplianceDataManager {
            constructor() {
                this.cache = new Map();
                this.cacheTimeout = 5 * 60 * 1000; // 5 minutes
                this.baseUrl = '/api/compliance';
            }
            
            async getData(endpoint) {
                const cacheKey = `${endpoint}_${Date.now()}`;
                const cached = this.cache.get(cacheKey);
                
                if (cached && Date.now() - cached.timestamp < this.cacheTimeout) {
                    return cached.data;
                }
                
                try {
                    const data = await this.fetchData(endpoint);
                    this.cache.set(cacheKey, { data, timestamp: Date.now() });
                    return data;
                } catch (error) {
                    DashboardErrorHandler.handleError(error, endpoint);
                    throw error;
                }
            }

            async fetchData(endpoint) {
                const response = await fetch(`${this.baseUrl}/${endpoint}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return await response.json();
            }

            clearCache() {
                this.cache.clear();
            }
        }

        // Error handling
        class DashboardErrorHandler {
            static handleError(error, context) {
                console.error(`Dashboard error in ${context}:`, error);
                
                const errorElement = document.getElementById('errorMessage');
                errorElement.textContent = `Error loading ${context}: ${error.message}`;
                errorElement.style.display = 'block';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    errorElement.style.display = 'none';
                }, 5000);

                // Show notification
                NotificationManager.show(`Error: ${error.message}`, 'error');
            }
        }

        // Notification system
        class NotificationManager {
            static show(message, type = 'info') {
                const container = document.getElementById('notificationContainer');
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.textContent = message;
                
                container.appendChild(notification);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }
        }

        // Enhanced Trend Visualization
        class EnhancedTrendVisualization {
            constructor() {
                this.charts = {};
                this.currentData = null;
                this.dataManager = new ComplianceDataManager();
                this.initializeCharts();
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Period selector functionality
                document.querySelectorAll('.period-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.handlePeriodChange(btn);
                    });
                });

                // Filter functionality
                document.getElementById('searchViolations').addEventListener('input', (e) => {
                    this.handleSearch(e.target.value);
                });

                document.getElementById('severityFilter').addEventListener('change', (e) => {
                    this.handleSeverityFilter(e.target.value);
                });

                // Export functionality
                document.getElementById('exportPDF').addEventListener('click', () => {
                    this.exportData('pdf');
                });

                document.getElementById('exportCSV').addEventListener('click', () => {
                    this.exportData('csv');
                });

                document.getElementById('exportJSON').addEventListener('click', () => {
                    this.exportData('json');
                });

                // Collapsible sections
                document.querySelectorAll('.analytics-section h2').forEach(header => {
                    header.addEventListener('click', (e) => {
                        this.toggleSection(e.target.closest('.analytics-section'));
                    });
                });
            }

            handlePeriodChange(button) {
                document.querySelectorAll('.period-btn').forEach(b => {
                    b.classList.remove('active');
                    b.setAttribute('aria-selected', 'false');
                });
                
                button.classList.add('active');
                button.setAttribute('aria-selected', 'true');
                
                const period = button.dataset.period;
                this.updateComparisonForPeriod(period);
                
                NotificationManager.show(`Updated to last ${period} days`, 'success');
            }

            handleSearch(query) {
                // Implement search functionality
                console.log('Searching for:', query);
            }

            handleSeverityFilter(severity) {
                // Implement severity filtering
                console.log('Filtering by severity:', severity);
            }

            exportData(format) {
                const data = this.currentData;
                let content, filename, mimeType;

                switch (format) {
                    case 'pdf':
                        // Implement PDF export
                        NotificationManager.show('PDF export not yet implemented', 'warning');
                        return;
                    case 'csv':
                        content = this.convertToCSV(data);
                        filename = 'compliance-data.csv';
                        mimeType = 'text/csv';
                        break;
                    case 'json':
                        content = JSON.stringify(data, null, 2);
                        filename = 'compliance-data.json';
                        mimeType = 'application/json';
                        break;
                }

                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);

                NotificationManager.show(`${format.toUpperCase()} export completed`, 'success');
            }

            convertToCSV(data) {
                // Simple CSV conversion
                const headers = ['Date', 'Score', 'Violations'];
                const rows = data.complianceScores?.map(item => 
                    [item.date, item.value, item.violations]
                ) || [];

                return [headers, ...rows].map(row => 
                    row.map(cell => `"${cell}"`).join(',')
                ).join('\n');
            }

            toggleSection(section) {
                section.classList.toggle('collapsed');
                const content = section.querySelectorAll('div:not(:first-child)');
                content.forEach(el => {
                    el.style.display = el.style.display === 'none' ? 'block' : 'none';
                });
            }

            initializeCharts() {
                this.createComplianceTrendChart();
                this.createViolationTrendChart();
                this.createPerformanceTrendChart();
                this.createComparisonChart();
                this.createViolationPieChart();
                this.createFileTypeChart();
            }

            createComplianceTrendChart() {
                const canvas = document.getElementById('complianceTrendChart');
                const ctx = canvas.getContext('2d');
                
                canvas.width = canvas.offsetWidth;
                canvas.height = 300;
                
                this.charts.compliance = { canvas, ctx };
            }

            createViolationTrendChart() {
                const canvas = document.getElementById('violationTrendChart');
                const ctx = canvas.getContext('2d');
                
                canvas.width = canvas.offsetWidth;
                canvas.height = 300;
                
                this.charts.violations = { canvas, ctx };
            }

            createPerformanceTrendChart() {
                const canvas = document.getElementById('performanceTrendChart');
                const ctx = canvas.getContext('2d');
                
                canvas.width = canvas.offsetWidth;
                canvas.height = 300;
                
                this.charts.performance = { canvas, ctx };
            }

            createComparisonChart() {
                const canvas = document.getElementById('comparisonChart');
                const ctx = canvas.getContext('2d');
                
                canvas.width = canvas.offsetWidth;
                canvas.height = 200;
                
                this.charts.comparison = { canvas, ctx };
            }

            createViolationPieChart() {
                const canvas = document.getElementById('violationPieChart');
                const ctx = canvas.getContext('2d');
                
                canvas.width = canvas.offsetWidth;
                canvas.height = 300;
                
                this.charts.pie = { canvas, ctx };
            }

            createFileTypeChart() {
                const canvas = document.getElementById('fileTypeChart');
                const ctx = canvas.getContext('2d');
                
                canvas.width = canvas.offsetWidth;
                canvas.height = 300;
                
                this.charts.fileType = { canvas, ctx };
            }

            drawTrendChart(chartData, chartType) {
                const chart = this.charts[chartType];
                if (!chart) return;

                const { canvas, ctx } = chart;
                const width = canvas.width;
                const height = canvas.height;
                const padding = 40;

                // Clear canvas
                ctx.clearRect(0, 0, width, height);

                if (!chartData || chartData.length < 2) {
                    this.drawNoDataMessage(ctx, width, height);
                    return;
                }

                // Calculate scales
                const dataWidth = width - 2 * padding;
                const dataHeight = height - 2 * padding;
                
                const minValue = Math.min(...chartData.map(d => d.value));
                const maxValue = Math.max(...chartData.map(d => d.value));
                const valueRange = maxValue - minValue || 1;

                // Draw grid
                ctx.strokeStyle = '#e0e0e0';
                ctx.lineWidth = 1;
                
                // Vertical grid lines
                for (let i = 0; i <= 5; i++) {
                    const x = padding + (dataWidth * i) / 5;
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, height - padding);
                    ctx.stroke();
                }

                // Horizontal grid lines
                for (let i = 0; i <= 5; i++) {
                    const y = padding + (dataHeight * i) / 5;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(width - padding, y);
                    ctx.stroke();
                }

                // Draw data line
                ctx.strokeStyle = '#007bff';
                ctx.lineWidth = 3;
                ctx.beginPath();

                chartData.forEach((point, index) => {
                    const x = padding + (dataWidth * index) / (chartData.length - 1);
                    const y = height - padding - ((point.value - minValue) / valueRange) * dataHeight;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });

                ctx.stroke();

                // Draw data points
                ctx.fillStyle = '#007bff';
                chartData.forEach((point, index) => {
                    const x = padding + (dataWidth * index) / (chartData.length - 1);
                    const y = height - padding - ((point.value - minValue) / valueRange) * dataHeight;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    ctx.fill();
                });
            }

            drawNoDataMessage(ctx, width, height) {
                ctx.fillStyle = '#6c757d';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No data available', width / 2, height / 2);
            }

            updateComparisonForPeriod(period) {
                // Update comparison chart based on selected period
                console.log(`Updating comparison for period: ${period} days`);
                // Implementation would fetch and update comparison data
            }

            async loadAndVisualizeData() {
                try {
                    // Hide loading overlay
                    document.getElementById('loadingOverlay').style.display = 'none';

                    // Load mock data (replace with actual API calls)
                    const data = this.getMockData();
                    this.currentData = data;

                    // Update all visualizations
                    this.updateAllVisualizations(data);
                    
                    NotificationManager.show('Dashboard data loaded successfully', 'success');
                } catch (error) {
                    DashboardErrorHandler.handleError(error, 'dashboard initialization');
                }
            }

            updateAllVisualizations(data) {
                // Update trend charts
                this.drawTrendChart(data.complianceScores, 'compliance');
                this.drawTrendChart(data.violationCounts, 'violations');
                this.drawTrendChart(data.performanceMetrics, 'performance');
                
                // Update indicators
                this.updateTrendIndicators(data);
                
                // Update other visualizations
                this.updateForecastVisualization(data.forecastData);
                this.updateTimelineVisualization(data.timelineData);
                this.updateProgressTracking(data.progressData);
                this.updateTrendComparison(data.comparisonData);
                this.updateInsightsPanel(data.insightsData);
                
                // Update metrics
                this.updateMetrics(data);
            }

            updateMetrics(data) {
                document.getElementById('complianceScore').textContent = data.complianceScore + '%';
                document.getElementById('totalViolations').textContent = data.totalViolations;
                document.getElementById('criticalViolations').textContent = data.criticalViolations;
                document.getElementById('executionTime').textContent = data.executionTime + 'ms';
                document.getElementById('filesProcessed').textContent = data.filesProcessed;
            }

            updateTrendIndicators(data) {
                // Update trend indicators
                const complianceIndicator = document.getElementById('complianceTrendIndicator');
                complianceIndicator.textContent = 'Trend: Improving';
                complianceIndicator.className = 'trend-indicator trend-improving';
            }

            updateForecastVisualization(data) {
                const container = document.getElementById('forecastContainer');
                if (!data) return;

                container.innerHTML = data.map(item => `
                    <div class="forecast-item">
                        <h4>${item.title}</h4>
                        <p>${item.description}</p>
                        <span class="confidence-indicator confidence-${item.confidence}">
                            ${item.confidence}% confidence
                        </span>
                    </div>
                `).join('');
            }

            updateTimelineVisualization(data) {
                const container = document.getElementById('timelineContainer');
                if (!data) return;

                container.innerHTML = data.map(item => `
                    <div class="timeline-item">
                        <div class="timeline-date">${item.date}</div>
                        <div class="timeline-content">
                            <strong>${item.title}</strong>
                            <p>${item.description}</p>
                        </div>
                    </div>
                `).join('');
            }

            updateProgressTracking(data) {
                const container = document.getElementById('progressContainer');
                if (!data) return;

                container.innerHTML = `
                    <div class="progress-section">
                        <h3>Overall Progress: ${data.overallProgress}%</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${data.overallProgress}%"></div>
                        </div>
                    </div>
                `;
            }

            updateTrendComparison(data) {
                const container = document.getElementById('trendIndicators');
                if (!data) return;

                container.innerHTML = Object.entries(data).map(([key, value]) => `
                    <div class="metric-card">
                        <div class="metric-title">${key}</div>
                        <div class="metric-value">${value.current}</div>
                        <div class="trend-indicator ${value.change > 0 ? 'trend-improving' : 'trend-declining'}">
                            ${value.change > 0 ? '+' : ''}${value.change}%
                        </div>
                    </div>
                `).join('');
            }

            updateInsightsPanel(data) {
                const container = document.getElementById('insightsContainer');
                if (!data) return;

                container.innerHTML = data.map(item => `
                    <div class="insight-item">
                        <h4>${item.title}</h4>
                        <p>${item.description}</p>
                        <div class="priority-badge priority-${item.priority.toLowerCase()}">
                            ${item.priority}
                        </div>
                        <ul>
                            ${item.actions.map(action => `<li>${action}</li>`).join('')}
                        </ul>
                    </div>
                `).join('');
            }

            getMockData() {
                return {
                    complianceScore: 88,
                    totalViolations: 6,
                    criticalViolations: 0,
                    executionTime: 1250,
                    filesProcessed: 286,
                    complianceScores: [
                        { date: '2024-01-01', value: 85 },
                        { date: '2024-01-02', value: 86 },
                        { date: '2024-01-03', value: 87 },
                        { date: '2024-01-04', value: 88 }
                    ],
                    violationCounts: [
                        { date: '2024-01-01', value: 8 },
                        { date: '2024-01-02', value: 7 },
                        { date: '2024-01-03', value: 6 },
                        { date: '2024-01-04', value: 6 }
                    ],
                    performanceMetrics: [
                        { date: '2024-01-01', value: 1050 },
                        { date: '2024-01-02', value: 1020 },
                        { date: '2024-01-03', value: 1000 },
                        { date: '2024-01-04', value: 1000 }
                    ],
                    forecastData: [
                        {
                            title: 'Compliance Improvement',
                            description: 'Expected to reach 90% compliance by next week',
                            confidence: 85
                        },
                        {
                            title: 'Performance Optimization',
                            description: 'Execution time expected to improve by 10%',
                            confidence: 72
                        }
                    ],
                    timelineData: [
                        {
                            date: '2024-01-01',
                            title: 'Initial Assessment',
                            description: 'Baseline compliance established'
                        },
                        {
                            date: '2024-01-04',
                            title: 'Violation Count Reduced',
                            description: 'Total violations reduced to 6'
                        }
                    ],
                    progressData: {
                        overallProgress: 85,
                        standardsProgress: 90,
                        performanceProgress: 80
                    },
                    comparisonData: {
                        'Compliance Score': { current: 88, previous: 85, change: 3.5 },
                        'Violation Count': { current: 6, previous: 8, change: -25 },
                        'Performance': { current: 1000, previous: 1050, change: -4.8 }
                    },
                    insightsData: [
                        {
                            title: 'Maintain Improvement Momentum',
                            description: 'Compliance is showing consistent improvement',
                            priority: 'HIGH',
                            actions: [
                                'Continue current improvement practices',
                                'Document successful strategies',
                                'Share best practices across team'
                            ]
                        },
                        {
                            title: 'Optimize Performance Further',
                            description: 'Performance metrics are improving but can be optimized',
                            priority: 'MEDIUM',
                            actions: [
                                'Review performance bottlenecks',
                                'Implement additional optimizations',
                                'Monitor performance trends'
                            ]
                        }
                    ]
                };
            }
        }

        // Initialize enhanced visualization
        const enhancedViz = new EnhancedTrendVisualization();
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            enhancedViz.loadAndVisualizeData();
        });

        // Auto-refresh dashboard every 30 seconds
        setTimeout(() => {
            window.location.reload();
        }, 30000);
    </script>
</body>
</html> 